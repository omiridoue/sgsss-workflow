---
title: Auxiliary Tools
teaching: 15
exercises: 10
---

::::::::::::::::::::::::::::::::::::::: objectives

- Understand how to reproduce code.
- Understand the benefits of containers.
- Clone a repository on GitHub.

::::::::::::::::::::::::::::::::::::::::::::::::::

:::::::::::::::::::::::::::::::::::::::: questions

- When should I use a pre-built container?
- How do I set up my own container?
- What is a remote codespace?

::::::::::::::::::::::::::::::::::::::::::::::::::


::: group 

### Browsing Docker Hub

- The container image is updated regularly, the latest version should be available alongside previous versions.
- The container image associated with a well established company, community, or other group that is well-known.
- There is a Dockerfile or other listing of what has been installed to the container image.
- The container image page has documentation on how to use the container image.

:::::::::::::::::::::::::::::::::::::::: discussion

If a container image is never updated, created by a random person, and does not have a lot of metadata, it is probably worth skipping over. Even if such a container image is secure, it is not reproducible and not a dependable way to run research computations.

::::::::::::::::::::::::::::

### Docker Recipe File

Much like a cookbook, you can pull out recipes and alter to own taste. This is how you normally get started building your own image, you can start with a base repository, and layer requirements.

``` docker

FROM bioconductor/bioconductor_docker:devel-R-4.4.1

RUN R -e "install.packages(c('Matrix', 'lattice', 'parallel', 'MASS', 'methods', 'xtable', 'network', 'vioplot', 'sna', 'codetools', 'dplyr', 'metafor', 'argparse', 'stringr', 'mixmeta'), repos = c(CRAN = 'https://cloud.r-project.org'))"

COPY rsiena_1.4.19.tar.gz .

RUN R -e "install.packages('rsiena_1.4.19.tar.gz', repos = NULL, type = 'source')"

```

### Workflow

``` nextflow.config

docker.enabled = true

```

:::

Many container platforms are available, but Apptainer is designed for ease-of-use on shared systems and in high performance computing (HPC) environments. Nextflow can build an immutable image based off a Docker recipe file.

::: group

### Building an Apptainer Image

``` bash
singularity pull docker://omiridoue-siena_r:0.8

```

### Workflow Definition

Within our workflow, we can declare a process container, and ensure we enable apptainer. 

:::::::::::::::::::::::::::: challenge

We can declare a different config file for different compute environments, or profiles. These profiles are stored under the conf sub-folder. 

::::::::: solution

``` nextflow.config
process.container = 'apptainer/omiridoue-siena_r-0.8.img'

apptainer.cacheDir = "apptainer"
apptainer.enabled = true

apptainer.autoMounts = true

```

:::::::::::::::::
::::::::::::::::::::::::::::::::::::::

### Declare 

```
profiles {
  awsbatch {
    includeConfig 'conf/awsbatch.config'
  }
  local {
    includeConfig 'conf/local.config'
    process.container = 'omiridoue/siena_r:0.8'
  }
  sge {
    includeConfig 'conf/sge.config'
  }
  slurm {
    includeConfig 'conf/slurm.config'
    process.executor = 'slurm'
    process.container = 'omiridoue/siena_r:0.8'
  }
  ci {
    includeConfig 'conf/ci.config'
  }
}
```
:::

:::::::::::::::::::::::::::::::::::::::: keypoints

- The Docker Hub is an online repository of container images.
- Find a container recipe file that works for your project and customise this.
- Nextflow can pull a docker container from Docker Hub and convert this to an Apptainer image.
- Docker is not permitted on most HPC environments, apptainer sif files are used instead.
- Containers are important to reproducible workflows and portability of workflows across environments.

::::::::::::::::::::::::::::::::::::::::::::::::::